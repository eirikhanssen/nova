/*
    ============================================
     ISBN verifyer
     Based on: http://www.hahnlibrary.net/libraries/isbncalc.html
     Can validate a list (array) of many isbns in one loop.
    ============================================
*/
function validateISBN(isbn_string) {
var numeric_only_isbn_string = isbn_string.toString().replace(/[^0-9]/g,'');
var len = numeric_only_isbn_string.length;

if(len <= 10) {
  if(!isValidISBN13(numeric_only_isbn_string)) {
      console.log(">> ISBN10 control digit FAIL: " + isbn_string);
      if(len < 10) {
        console.log("only " + len + " digits!");
      }
    } else {
      console.log("ISBN10 control digit OK: " + isbn_string);
    }
} else if(len <= 13) {
    if(!isValidISBN13(numeric_only_isbn_string)) {
      console.log(">> ISBN 13 control digit FAIL: " + isbn_string);
      if(len < 13) {
        console.log("only " + len + " digits!");
      }
    } else {
      console.log("ISBN13 control digit OK: " + isbn_string);
    }
} else 
  console.log("FAIL: too many digits in isbn");
}

function isValidISBN13(isbn_string)
{
var isbn_num_only = isbn_string.toString().replace(/[^0-9]/g,'');
 var calculated_checksum_digit;
 var isbn_base = isbn_num_only.substring(0,12);
 var supplied_checksum_digit = isbn_num_only.substring(12,13);
 
 var isbn_working_string = isbn_base;

  // if source is less than 12 chars, we make it 12 chars
  if(isbn_base.length < 12) {
    var holdString = '000000000000' + isbn_base;
    isbn_base = holdString.substring(holdString.length - 12, holdString.length);
  }
 var csumTotal = 0; // The checksum working variable starts at zero

 // If the source message string is less than 12 characters long, we make it 12 characters

  // Calculate the checksum value for the message

 for( charPos = isbn_working_string.length - 1; charPos >= 0; charPos--) 
  {
  if( charPos / 2 == parseInt(charPos/2) )
   csumTotal = csumTotal + (parseInt(isbn_working_string.substring(charPos,charPos+1)));
  else
   csumTotal = csumTotal + (3 * parseInt(isbn_working_string.substring(charPos,charPos+1)));
  }

 // Calculate the checksum digit

 var remainder = csumTotal - parseInt(csumTotal/10) * 10;
 if( remainder == 0 )
  calculated_checksum_digit = 0;
 else
  calculated_checksum_digit = 10 - remainder;

  return calculated_checksum_digit == supplied_checksum_digit;
}


function isValidISBN10(isbn_string)
{
var isbn_num_only = isbn_string.toString().replace(/[^0-9]/g,'');
 var calculated_checksum_digit;
 var isbn_base = isbn_num_only.substring(0,9);
 var supplied_checksum_digit = isbn_num_only.substring(9,10);
 var isbn_working_string = isbn_base;
 var csumTotal = 0; // The checksum working variable starts at zero

  // if source is less than 9 chars, we make it 9 chars
  if(isbn_base.length < 9) {
    var holdString = '000000000' + isbn_base;
    isbn_base = holdString.substring(holdString.length - 9, holdString.length);
  }



 // Calculate the checksum value for the message

 for( var charPos = 0; charPos <= 8; charPos++) 
  {
  csumTotal = csumTotal + ((charPos+1) * parseInt(isbn_base.substring(charPos,charPos+1)));

  }

 // Calculate the checksum digit

 var remainder = csumTotal - parseInt(csumTotal/11) * 11;
 if( remainder == 0 )
  calculated_checksum_digit = '0';
 if ( remainder == 10 )
  calculated_checksum_digit = 'X';
 else
  calculated_checksum_digit = remainder;

  return calculated_checksum_digit == supplied_checksum_digit;
}

function validateISBNs(isbn_array) {
  for (var k = 0; k < isbn_array.length; k++) {
    validateISBN(isbn_array[k]);
  }
}


var rapporter_isbns = ["82-7894000-2",
"82-7894-012-6",
"82-7894-013-4",
"82-7894014-2",
"82-7894-015-0",
"82-7894o16-9",
"82-7894-017-7",
"82-7894-018-5",
"82-7894-019-3",
"82-7894-020-7",
"82-7894-021-5",
"82-7894001-0",
"82-7894-022-3",
"82-7894-023-1",
"82-7894-025-8",
"82-7894-026-6",
"82-7894-027-4",
"82-7894-028-2",
"82-7894-029-0",
"827894-030-4",
"82-7894-031-2",
"82-7894-032-0",
"82-7894002-9",
"8003-72-7894",
"82-7894004-5",
"82-7894005-3",
"82-7894006-1",
"82-7894008-8",
"82-7894009-6",
"82-7894",
"82-7894-033-9",
"82-7894-044-4",
"82-7894-045-2",
"82-77894-046-0",
"82-7894-047-9",
"82-7894-048-7",
"82-7894-049-5",
"82-7894-050-9",
"82-7894-051-7",
"82-7894-052-5",
"82-7894-053-3",
"82-7894-054-1",
"82.7894-056-8",
"82-7894-057-6",
"82-7894-058-4",
"82-7894-034-7",
"82-7894-059-2",
"82-7894-060-6",
"82-7894-061-4",
"82-7894-062-2",
"82-7894-063-0",
"82-7894-064-9",
"82-7894-065-7",
"82-7894-066-5",
"82-7894-067-3",
"82-7894-035-5",
"82-7894-036-3",
"82-7894-037-1",
"82-7894-039-8",
"82-7894-040-1",
"82-7894-042-8",
"82-7894-043-6",
"82-7894-068-1",
"82-7894-080-0",
"82-7894-081-9",
"82-7894-082-7",
"82-7894-083-5",
"82-7894-084-3",
"82-7894-085-1",
"82-7894-070-3",
"82-7894-071-1",
"82-789-073-8",
"82-7894-074-6",
"82-7894-075-4",
"82-7894-076-2",
"82-7894-077-0",
"82-7894-078-9",
"82-7894-088-6",
"82-7894-097-5",
"82-7894-098-3",
"82-7894-099-1",
"82-7894-100-9",
"82-7894-101-7",
"82-7894-102-5",
"82-7894-103-3",
"82-7894-104-1",
"82-7894-108-4",
"82-7894-109-2",
"82-7894-089-4",
"82-7894-090-8",
"82-7894-091-6",
"82-7894-092-4",
"82-7894-093-2",
"82-7894-094-0",
"82-7894-095-9",
"82-7894-096-7",
"82-7894-106-8",
"82-7894-117-3",
"82-7894-118-1",
"8-7894-120-3",
"82-7894-121-1",
"82-7894-123-8",
"82-7894-124-6",
"82-7894-125-4",
"82-7894-126-2",
"82-7894-127-0",
"82-7894-128-9",
"82-7894-107-6",
"82-7894-110-6",
"82-7894-111-4",
"82-7894-112-2",
"2-7894-113-0",
"82-7894-114-9",
"82-7894-115-7",
"82-7894-116-5",
"82-7894-129-7",
"82-7894-139-4",
"82-7894-140-8",
"82-7894-141-6",
"82-7894-142-4",
"82-7894-143-2",
"82-7894-144-0",
"82-7894-145-9",
"82-7894-146-7",
"82-7894-148-3",
"82-7894-149-1",
"82-7894-130-0",
"82-7894-150-5",
"82-7894-151-3",
"82-7894-131-9",
"82-7894-132-7",
"82-7894-133-5",
"82-7894-134-3",
"82-7894-135-1",
"82-7894-137-8",
"82-7894-138-6",
"82-7894-152-1",
"82-7894-162-9",
"82-7894-163-7",
"82-7894-164-5",
"82-7894-165-3",
"82-7894-166-1",
"82-7894-168-8",
"82-7894-169-6",
"82-7894-171-8",
"82-7894-172-6",
"82-7894-173-4",
"82-7894-154",
"82-7894-174-2",
"82-7894-175-0",
"82-7894-176-9",
"82-7894-177-7",
"82-7894-178-5",
"82-7894-179-3",
"82-7894-180-7",
"82-7894-155-6",
"82-7894-156-4",
"82-7894-157-2",
"82-7894-158-0",
"82-7894-159-9",
"82-7894-160-2",
"82-7894-161-0",
"82-7894-188-2",
"82-7894-185-8",
"82-7894-181-5",
"82-7894-191-2",
"82-7894-192-0",
"82-7894-193-9",
"82-7894-194-7",
"82-7894-195-5",
"82-7894-196-3",
"82-7894-197-1",
"82-7894-199-8",
"82-7894-200-5",
"82-7894-182-3",
"82-7894-183-1",
"82-7894-186-6",
"82-7894-187-4",
"82-7894-189-0",
"82-7894-190-4",
"82-7894-202-1",
"82-7894-205-6",
"82-7894-201-3",
"82-7894-212-9",
"82-7894-213-7",
"82-7894-214-5",
"82-7894-215-3",
"82-7894-261-1",
"82-7894-218-8",
"82-7894-219-6",
"82-7894-221-8",
"82-7894-222-6",
"82-7894-223-4",
"82-7894-224-2",
"82-7894-225-0",
"82-7894-226-9",
"82-7894-227-7",
"82-7894-228-5",
"7894-204-08",
"82-7894-189-0",
"82-7894-207-2",
"82-7894-209-9",
"82-7894-210-2",
"82-7894-211-0",
"82-7894-229-3",
"82-7994-293-0",
"82-7894-240-4",
"82-7894-241-2",
"82-7894-242-0",
"82-7894-243-9",
"82-7894-244-7",
"82-7894-245-5",
"82-7894-246-3",
"82-7894-247-1",
"82-7894-249-8",
"82-7894-230-7",
"82-7894-231-5",
"82-7894-232-3",
"82-7894-233-1",
"82-7894-235-8",
"82-7894-236-6",
"82-7894-237-4",
"82-7894-238-2",
"978-82-7894-250-5",
"978-82-7894-260-4",
"978-82-7894-261-1",
"978-82-7894-262-8",
"978-82-7894-263-5",
"978-82-7894-264-2",
"978-82-7894-266-6",
"978-82-7894-267-3",
"987-82-7894-268-0",
"987-82-7894-269-7",
"978-82-7894-252-9",
"978-82-7894-271-0",
"978-82-7894-272-7",
"978-82-7894-273-4",
"9788278942536",
"978-82-7894-254-3",
"978-82-7894-252-9",
"978-827894-256-7",
"978-82-7894-257-4",
"978-82-7894-258-1",
"978-82-7894-259-8",
"978-82-7894-274-1",
"978-82-7894-286-4",
"978-82-7894-287-1",
"978-82-7894-288-8",
"978-82-7894-289-5",
"978-82-7894-290-1",
"978-82-7894-291-8",
"978-82-7894-292-5",
"978-82-7894-293-2",
"978-82-7894-294-9",
"978-82-7894-275-8",
"978-82-78-94277-2",
"978-82-7894-278-9",
"978-82-7894-280-2",
"978-82-78-94281-9",
"978-82-78-94283-3",
"978-82-78-94284-0",
"978-82-78-94285-7",
"978-82-7894-276-5",
"978-82-7894-295-6",
"978-82-7894-306-9",
"978-82-7894-307-6",
"978-82-7894-308-3",
"978-82-7894-328-1",
"978-82-7894-330-4",
"978-82-7894-331-1",
"978-82-7894-333-5",
"978-82-7894-334-2",
"978-82-7894-335-9",
"978-82-7894-336-6",
"978-82-7894-297-0",
"978-82-7894-337-3",
"978-82-7894-230-3",
"978-82-7894-298-7",
"978-82-7894-299-4",
"978-82-7894-300-7",
"978-82-7894-302-1",
"978-82-7894-303-8",
"978-82-7894-304-5",
"978-82-7894-305-2",
"978-82-78-94339-7",
"978-82-78-94341-0",
"978-82-78-94350-2",
"978-82-78-94351-9",
"978-82-78-94352-6",
"978-82-78-94353-3",
"978-82-78-94354-0",
"978-82-78-94355-7",
"978-82-78-94356-4",
"978-82-78-94-357-1",
"978-82-78-7894-358-8",
"978-82-78-7894-359-5",
"978-82-78-94342-7",
"978-82-78-94-360-1",
"978-82-7894-338-0",
"978-82-78-94343-4",
"978-82-78-94344-1",
"978-82-78-94345-8",
"978-82-78-94347-2",
"978-82-78-94348-9",
"978-82-78-94349-6",
"978-82-78-94-370-0",
"978-82-78-94-381-6",
"978-82-78-94-382-6",
"978-82-7894-384-7",
"978-82-78-94-384-7",
"978-78-94-385-4",
"978-82-78-94-386-1",
"987-82-7894-387-8",
"978-82-7894-388-5",
"978-82-7894-389-2",
"978-82-7894-3090-8",
"978-82-78-94-371-7",
"978-82-7894-391-5",
"978-82-7894-400-4",
"978-82-7894-401-1",
"978-82-7894-402-8",
"978-82-7894-403-5",
"978-82-7894-404-2",
"978-82-7894-405-9",
"978-82-7894-406-6",
"978-82-7894-412-7",
"978-82-78-94-372-4",
"978-82-78-94-373-1",
"978-82-78-94-374-8",
"978-82-78-94-375-5",
"978-82-78-94-376-2",
"978-82-78-94-378-6",
"978-82-78-94-379-3",
"978-82-7894-408-0",
"978-7894-442-4",
"978-82-7894-452-3",
"978-82-7894-453-0",
"978-82-7894-410-3",
"978-82-7894-414-1",
"978-82-7894-418-9",
"978-82-7894-422-6",
"978-82-7894-424-0",
"978-82-7894-426-4",
"978-82-7894-432-5",
"978-82-7894-434-9",
"978-82-7894-454-7",
"978-82-7894-455-4",
"978-82-7894-476-9",
"978-82-7894-477-6",
"978-82-7894-478-3",
"978-82-7894-479-0",
"978-82-7894-482-0",
"978-82-7894-483-7",
"978-82-7894-484-4",
"978-82-7894485-1",
"978-82-7894-486-8",
"978-82-7894-487-5",
"978-82-7894-488-2",
"978-82-7894-489-9",
"978-82-7894-490-5",
"978-82-7894-491-2",
"978-82-7894-456-1",
"978-82-7894-457-8",
"978-82-7894-460-8",
"978-82-7894-461-5",
"978-82-7894-462-2",
"978-82-7894-463-9",
"978-82-7894-464-6",
"978-82-7894-465-3",
"978-82-7894-466-0",
"978-82-7894-467-7",
"978-82-7894-468-4",
"978-82-78-469-1",
"978-82-7894-474-5(tryktutgave)",
"978-82-7894-475-2",
"978-82-7894-474-5(tryktutgave)",
"978-82-7894-475-2",
"978-82-7894-492-9",
"978-82-7894-493-6",
"978-82-7894-514-8",
"978-82-7894-515-5(elektronisk)",
"978-82-7894-516-2",
"978-82-7894-518-6",
"978-82-7894-520-9",
"978-82-7894-522-3",
"978-82-7894-524-7",
"978-82-7894-528-5",
"978-82-7894-532-2",
"978-82-7894-534-6",
"978-82-7894-536-0",
"978-82-7894-494-3",
"978-82-7894-495-0",
"978-82-7894-496-7",
"978-82-7894-497-4",
"978-82-7894-498-1",
"978-82-7894-499-8",
"978-82-7894-504-9",
"978-82-7894-505-6",
"978-82-7894-506-3",
"978-82-7894-507-0",
"978-82-7894-508-7",
"978-82-7894-510-0",
"978-82-7894-512-4",
"078-82-7894-538-4",
"978-82-7894-562-9",
"978-82-7894-564-3",
"978-82-7894-566-7",
"978-82-7894-568-1",
"978-82-7894-570-4",
"978-82-7894-540-7",
"978-82-7894-542-1",
"978-82-7894-546-9",
"978-82-7894-550-6",
"978-82-7894-554-4",
"978-82-7894-556-8",
"978-82-7894-557-5",
"978-82-7894-558-2",
"978-82-7894-560-5",
"978-82-7894-572-8",
"978-82-7894-574-2",
"978-82-7894-578-0",
"978-82-7894-580-3",
"978-82-7894-582-7",
"978-82-7894-588-9",
"978-82-7894-590-2",
"978-82-7894-592-6",
"978-82-7894-593-3",
"978-82-7894-595-7"];

//validateISBNs(isbns_to_check);

validateISBNs(rapporter_isbns);
